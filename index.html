<!doctype html>
<html lang="ko">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
    <title>Portfolio — @ryo_pht</title>
    <!-- React & ReactDOM (UMD) -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <!-- TailwindCSS (CDN) -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>:root{color-scheme:dark}</style>
  </head>
  <body class="min-h-screen bg-neutral-950 text-neutral-100">
    <div id="root"></div>

    <!-- 데이터 먼저 로드 -->
    <script src="./items.js?v=3"></script>

    <!-- 앱 코드 -->
    <script>
      const { useState, useEffect, useRef } = React;
      const items = window.ITEMS || [];

      const ratioToCss = (r) => (r || "3/2").replace("/", " / ");

      // 모델(X) 링크: 닉네임은 숨기고 @handle만, 링크 색+밑줄, 클릭 시 라이트박스 열림 방지
      function renderModelLinks(models = []) {
        return models.map((m, i) => {
          const handle =
            m?.handle
              ? (m.handle.startsWith("@") ? m.handle : "@" + m.handle)
              : (m?.url
                  ? "@" + m.url.replace(/^https?:\/\/(www\.)?x\.com\//, "").split("/")[0]
                  : (m?.name ? "@" + m.name : "@"));
          const url = m?.url || (m?.handle ? `https://x.com/${handle.replace(/^@/, "")}` : "#");
          return React.createElement(React.Fragment, { key: "m"+i },
            React.createElement("a", {
              href: url, target: "_blank", rel: "noopener noreferrer",
              className: "underline underline-offset-2 decoration-sky-400/70 text-sky-300 hover:text-sky-200",
              onClick: (e) => e.stopPropagation()
            }, handle),
            (i < models.length - 1) ? React.createElement("span", { className:"text-neutral-400" }, ", ") : null
          );
        });
      }

      function Card({ item, onOpen }) {
        const imgRef = useRef(null);
        const hasTags   = Array.isArray(item.tags) && item.tags.length > 0;
        const hasModels = Array.isArray(item.models) && item.models.length > 0;

        return React.createElement(
          "figure",
          { className:"group relative mx-auto flex justify-center overflow-visible", onContextMenu:(e)=>e.preventDefault() },
          React.createElement(
            "div",
            {
              className:"relative cursor-zoom-in rounded-2xl shadow-lg ring-1 ring-white/10 w-full",
              style:{ aspectRatio: ratioToCss(item.ratio), WebkitTapHighlightColor:"transparent", touchAction:"manipulation" },
              onClick:onOpen
            },
            React.createElement("div",{ className:"pointer-events-none absolute inset-0 -z-10 overflow-hidden rounded-2xl", "aria-hidden":true },
              React.createElement("div",{ className:"absolute inset-0 bg-center bg-cover blur-md sm:blur-lg scale-110 opacity-60",
                style:{ backgroundImage: `url(${item.src})` } }),
              React.createElement("div",{ className:"absolute inset-0 rounded-2xl bg-black/30" })
            ),
            React.createElement("img", {
              ref: imgRef,
              src: item.src,
              alt: item.alt || item.title || "",
              loading: "lazy",
              decoding: "async",
              className:"absolute inset-0 h-full w-full rounded-2xl select-none object-cover",
              draggable: false
            }),
            React.createElement("figcaption", { className:"absolute inset-x-0 bottom-0" },
              React.createElement("div",{ className:"pointer-events-auto mx-2 mb-2 rounded-xl bg-black/40 px-3 py-2 backdrop-blur-sm ring-1 ring-white/10 transition-colors duration-200 group-hover:bg-black/55" },
                React.createElement("div",{ className:"flex flex-wrap items-center gap-x-2 gap-y-1 text-[11px] leading-tight" },
                  React.createElement("span",{ className:"font-medium text-neutral-50" }, item.title || ""),
                  (hasModels) && React.createElement("span",{ className:"text-neutral-300" }, "•"),
                  (hasModels) && React.createElement("span",{ className:"text-neutral-300 flex items-center gap-1" }, renderModelLinks(item.models)),
                  (hasTags) && React.createElement("span",{ className:"text-neutral-300" }, "•"),
                  (hasTags) && React.createElement("span",{ className:"text-neutral-300" }, item.tags.join(" · "))
                )
              )
            )
          )
        );
      }

      function App() {
        const [openIndex, setOpenIndex] = useState(null);
        const [view, setView] = useState('feed');
        const [admin, setAdmin] = useState(false);
        const [showEditor, setShowEditor] = useState(false);
        const [gearBody, setGearBody] = useState('X-T30 II');
        const [gearLens, setGearLens] = useState('35/1.7 · 17-70/2.8');
        const [planText, setPlanText] = useState('');
        const [plan, setPlan] = useState([
          { date:'2025-10-03', title:'일러스타 페스', place:'KINTEX', note:'행사 촬영' },
          { date:'2025-10-04', title:'일러스타 페스', place:'KINTEX', note:'행사 촬영' },
          { date:'2025-09-27', title:'부천만화축제', place:'부천', note:'촬영' },
          { date:'2025-09-28', title:'부천만화축제', place:'부천', note:'촬영' },
        ]);
        const [viewMonth, setViewMonth] = useState({ year: 2025, month: 10 });
        const [selectedDate, setSelectedDate] = useState(null);

        const close = () => setOpenIndex(null);
        const next  = () => setOpenIndex((i) => (i === null ? null : (i + 1) % items.length));
        const prev  = () => setOpenIndex((i) => (i === null ? null : (i - 1 + items.length) % items.length));

        useEffect(() => {
          function onKey(e){ if(e.key==='Escape') close(); if(e.key==='ArrowRight') next(); if(e.key==='ArrowLeft') prev(); }
          window.addEventListener('keydown', onKey);
          return () => window.removeEventListener('keydown', onKey);
        }, []);

        useEffect(() => {
          try {
            const sp = new URLSearchParams(window.location.search);
            if (sp.get('admin') === '1') setAdmin(true);
            const gb = localStorage.getItem('portfolio.gear.body');
            const gl = localStorage.getItem('portfolio.gear.lens');
            const legacy = localStorage.getItem('portfolio.gear');
            if (gb) setGearBody(gb);
            if (gl) setGearLens(gl);
            if (!gb && !gl && legacy) {
              const parts = legacy.split('•');
              setGearBody((parts[0] || 'X-T30 II').trim());
              setGearLens((parts[1] || '35/1.7 · 17-70/2.8').trim());
            }
            const p = localStorage.getItem('portfolio.plan');
            let current = p ? JSON.parse(p) : plan;
            current = (current || []).filter(e => !(e?.date === '2025-10-11' || (e?.title || '').includes('호요랜드')));
            setPlan(current);
            setPlanText(JSON.stringify(current, null, 2));
            localStorage.setItem('portfolio.plan', JSON.stringify(current));
          } catch {}
        }, []);

        // 캘린더 유틸
        const y = viewMonth.year, m = viewMonth.month;
        const first = new Date(y, m - 1, 1);
        const offset = first.getDay();
        const last = new Date(y, m, 0).getDate();
        const cells = Array(offset).fill(null).concat(Array.from({ length: last }, (_, i) => i + 1));
        while (cells.length % 7) cells.push(null);
        const weeks = [];
        for (let i=0;i<cells.length;i+=7) weeks.push(cells.slice(i,i+7));
        const ym = `${y}-${String(m).padStart(2,'0')}`;
        const planMonth = plan.filter(e => e.date.startsWith(ym));
        const planMap = planMonth.reduce((acc, e) => { acc[e.date] = (acc[e.date] || []).concat(e); return acc; }, {});

        // 대표사진 선택( hero 우선 → 없으면 첫 항목 )
        const hasItems  = items.length > 0;
        const heroItem  = hasItems ? (items.find(it => it.hero) || items[0]) : null;
        const heroSrc   = heroItem ? heroItem.src : "";
        const heroRatio = heroItem ? (heroItem.ratio || "3/2") : "3/2";

        // ✅ 최신순 정렬(날짜 내림차순), 날짜 없으면 가장 오래된 취급
        const sorted = [...items].sort((a, b) => {
          const ad = a?.date ? new Date(a.date) : new Date(0);
          const bd = b?.date ? new Date(b.date) : new Date(0);
          return bd - ad;
        });

        // ✅ 피드 목록 = 최신순에서 대표사진만 제외(중복 방지)
        const listItems = heroItem ? sorted.filter(it => it.id !== heroItem.id) : sorted;

        return React.createElement(
          "div", { className:"min-h-screen bg-neutral-950 px-4 text-neutral-100" },

          // 헤더
          React.createElement("header",{ className:"sticky top-0 z-10 border-b border-neutral-800/60 bg-neutral-950/70 backdrop-blur" },
            React.createElement("div",{ className:"mx-auto flex max-w-screen-sm items-center justify-between py-3" },
              React.createElement("h1",{ className:"text-base sm:text-lg font-semibold tracking-tight" },
                React.createElement("span",{ className:"font-semibold" },"Portfolio"),
                React.createElement("a",{ href:"https://x.com/ryo_pht", target:"_blank", rel:"noopener noreferrer", className:"ml-2 text-neutral-400 underline-offset-4 hover:underline" },"@ryo_pht")
              ),
              React.createElement("div",{ className:"flex items-center gap-2" },
                React.createElement("div",{ className:"rounded-lg bg-neutral-900/60 ring-1 ring-white/10 p-1 text-[11px]" },
                  React.createElement("button",{ onClick:()=>setView('feed'), className:"px-2 py-1 rounded-md " + (view==='feed' ? "bg-white/15 text-white" : "text-neutral-300 hover:bg-white/5"), "aria-pressed":view==='feed' },"사진"),
                  React.createElement("button",{ onClick:()=>setView('plan'), className:"ml-1 px-2 py-1 rounded-md " + (view==='plan' ? "bg-white/15 text-white" : "text-neutral-300 hover:bg-white/5"), "aria-pressed":view==='plan' },"플랜")
                ),
                // 모바일: 버튼 옆 기어 정보
                React.createElement("div",{ className:"sm:hidden text-[10px] text-neutral-500 leading-tight" },
                  React.createElement("div",null,gearBody),
                  React.createElement("div",{ className:"text-neutral-500/90" },gearLens)
                ),
                // 데스크탑: 우측 정렬 기어 정보
                React.createElement("div",{ className:"hidden sm:block text-[10px] text-neutral-500 leading-tight text-right" },
                  React.createElement("div",null,gearBody),
                  React.createElement("div",{ className:"text-neutral-500/90" },gearLens)
                )
              ),
              admin && React.createElement("button",{ onClick:()=>setShowEditor(true), className:"rounded-md bg-white/10 px-2 py-1 text-[11px] text-white ring-1 ring-white/20 hover:bg-white/15" },"수정")
            )
          ),

          // 대표사진 (핸들/링크 포함) + 🔥 클릭 시 라이트박스 오픈
          (view!=='plan' && heroItem) && React.createElement(React.Fragment,null,
            React.createElement("section",{ className:"mx-auto max-w-screen-sm pt-4" },
              React.createElement("figure",{ className:"relative w-full overflow-hidden rounded-2xl ring-1 ring-white/10 shadow-md" },
                React.createElement("div",{
                  className:"relative w-full cursor-zoom-in",
                  style:{ aspectRatio: ratioToCss(heroRatio) },
                  onClick: () => setOpenIndex(items.findIndex(x => x.id === heroItem.id))
                },
                  React.createElement("img",{ src:heroSrc, alt:"대표 사진", className:"absolute inset-0 h-full w-full object-cover select-none", draggable:false })
                ),
                React.createElement("figcaption", { className:"absolute inset-x-0 bottom-0" },
                  React.createElement("div",{ className:"pointer-events-auto mx-2 mb-2 rounded-xl bg-black/40 px-3 py-2 backdrop-blur-sm ring-1 ring-white/10" },
                    React.createElement("div",{ className:"flex flex-wrap items-center gap-x-2 gap-y-1 text-[11px] leading-tight" },
                      React.createElement("span",{ className:"font-medium text-neutral-50" }, heroItem.title || ""),
                      Array.isArray(heroItem.models) && heroItem.models.length
                        ? React.createElement("span",{ className:"text-neutral-300" }, "•")
                        : null,
                      Array.isArray(heroItem.models) && heroItem.models.length
                        ? React.createElement("span",{ className:"text-neutral-300 flex items-center gap-1" }, renderModelLinks(heroItem.models))
                        : null
                    )
                  )
                )
              )
            ),

            // 피드(대표사진 제외, 최신순)
            React.createElement("main",{ className:"mx-auto max-w-screen-sm space-y-5 py-6" },
              listItems.map((it,i)=>React.createElement(
                Card,
                { key:it.id, item:it, onOpen:()=>setOpenIndex(items.findIndex(x=>x.id===it.id)) }
              ))
            )
          ),

          // 플랜
          view==='plan' && React.createElement("section",{ className:"mx-auto max-w-screen-sm pt-3" },
            React.createElement("div",{ className:"rounded-2xl bg-neutral-900/50 ring-1 ring-white/10 p-3" },
              React.createElement("div",{ className:"flex items-center justify-between" },
                React.createElement("h2",{ className:"text-sm font-semibold text-neutral-100" }, `${y}년 ${m}월 플랜`),
                React.createElement("div",{ className:"rounded-lg bg-neutral-800/60 ring-1 ring-white/10 p-1 text-[11px]" },
                  React.createElement("button",{ onClick:()=>setViewMonth({year:2025,month:9}), className:"px-2 py-1 rounded-md " + (viewMonth.month===9?"bg-white/15 text-white":"text-neutral-300 hover:bg-white/5"), "aria-pressed":viewMonth.month===9 },"9월"),
                  React.createElement("button",{ onClick:()=>setViewMonth({year:2025,month:10}), className:"ml-1 px-2 py-1 rounded-md " + (viewMonth.month===10?"bg-white/15 text-white":"text-neutral-300 hover:bg-white/5"), "aria-pressed":viewMonth.month===10 },"10월")
                )
              ),
              React.createElement("div",{ className:"mt-2 grid grid-cols-7 text-center text-[11px] text-neutral-400" },
                React.createElement("div",null,"Sun"),React.createElement("div",null,"Mon"),React.createElement("div",null,"Tue"),
                React.createElement("div",null,"Wed"),React.createElement("div",null,"Thu"),React.createElement("div",null,"Fri"),React.createElement("div",null,"Sat")
              ),
              React.createElement("div",{ className:"mt-1 grid grid-cols-7 gap-1" },
                (function(){
                  const out = [];
                  const first = new Date(y, m - 1, 1);
                  const offset = first.getDay();
                  const last = new Date(y, m, 0).getDate();
                  const cells = Array(offset).fill(null).concat(Array.from({ length: last }, (_, i) => i + 1));
                  while (cells.length % 7) cells.push(null);
                  for (let i=0;i<cells.length;i+=7) {
                    const w = cells.slice(i,i+7);
                    w.forEach((d,di)=>{
                      const dateStr = d ? `${ym}-${String(d).padStart(2,'0')}` : null;
                      const has = d && planMap[dateStr];
                      const sel = d && selectedDate===dateStr;
                      out.push(
                        React.createElement("button",{
                          key:i+'-'+di,
                          onClick:()=>{ if(!d) return; if(has) setSelectedDate(sel?null:dateStr); },
                          className:"aspect-square rounded-lg text-xs flex items-center justify-center " + (d ? (sel ? "text-neutral-200 bg-neutral-800/80 ring-1 ring-white/20" : "text-neutral-200 bg-neutral-900/60 hover:bg-neutral-800/60 ring-1 ring-white/10") : "bg-transparent"),
                          disabled:!d,
                          title:has ? planMap[dateStr].map(e=>e.title).join(', ') : undefined
                        },
                          React.createElement("div",{ className:"relative" },
                            React.createElement("span",null,d ?? ""),
                            has ? React.createElement("span",{ className:"absolute -bottom-1 left-1/2 -translate-x-1/2 h-1.5 w-1.5 rounded-full bg-emerald-400"}) : null
                          )
                        )
                      );
                    });
                  }
                  return out;
                })()
              ),
              React.createElement("div",{ className:"mt-3 space-y-1" },
                planMonth.map((e,i)=>{
                  const active = selectedDate===e.date;
                  return React.createElement("button",{
                    key:i, onClick:()=>setSelectedDate(active?null:e.date),
                    className:"w-full text-left flex items-center justify-between rounded-lg ring-1 px-2 py-1 text-[11px] " + (active ? "bg-neutral-700/40 ring-white/20" : "bg-black/30 ring-white/10 hover:bg-neutral-800/60")
                  },
                    React.createElement("span",{ className:"flex items-center gap-2 text-neutral-200" },
                      React.createElement("span",{ className:"inline-block h-1.5 w-1.5 rounded-full bg-emerald-400"}),
                      React.createElement("span",null, `${e.date.slice(5)} ${e.title}`)
                    ),
                    React.createElement("span",{ className:"text-neutral-400" }, e.place)
                  );
                }),
                !planMonth.length && React.createElement("div",{ className:"text-[11px] text-neutral-400" },"이번 달 일정이 없습니다.")
              )
            )
          ),

          // 라이트박스
          openIndex!==null && React.createElement("div",{ className:"fixed inset-0 z-50 bg-black/90 backdrop-blur-sm", onContextMenu:(e)=>e.preventDefault(), role:"dialog", "aria-modal":true },
            React.createElement("div",{ className:"absolute inset-0 flex items-center justify-center p-4", onClick:(e)=>{ if(e.target===e.currentTarget) close(); } },
              (function(){
                const curr = items[openIndex];
                return React.createElement("img",{ src:curr.src, alt:curr.alt || curr.title || "", className:"max-h-[90vh] max-w-[94vw] select-none object-contain cursor-zoom-out", draggable:false, onClick:close });
              })(),
              (function(){
                const curr = items[openIndex], ex = curr.exif;
                if (!ex) return null;
                return React.createElement("div",{ className:"absolute bottom-6 left-1/2 -translate-x-1/2 max-w-[90vw] rounded-xl bg-black/40 px-3 py-2 text-center text-[12px] text-neutral-100 ring-1 ring-white/10" },
                  React.createElement("div",{ className:"text-sm font-medium text-neutral-50" }, curr.title || ""),
                  React.createElement("div",{ className:"mt-1 text-[11px] text-neutral-300" },
                    `${ex.camera || ""} / ${ex.lens || ""} / ${ex.focal || ""} / ${ex.shutter || ""} / ${ex.aperture || ""} / ${ex.iso ? "ISO " + ex.iso : ""} / ${ex.date || ""}`
                  )
                );
              })(),
              React.createElement("button",{ className:"absolute right-4 top-4 rounded-full bg-white/10 px-3 py-1 text-sm text-white ring-1 ring-white/20 transition hover:bg-white/20", onClick:close, "aria-label":"닫기" },"닫기"),
              React.createElement("button",{ className:"absolute left-3 top-1/2 -translate-y-1/2 rounded-full bg-white/10 px-3 py-2 text-xl text-white ring-1 ring-white/20 transition hover:bg-white/20", onClick:prev, "aria-label":"이전" },"‹"),
              React.createElement("button",{ className:"absolute right-3 top-1/2 -translate-y-1/2 rounded-full bg-white/10 px-3 py-2 text-xl text-white ring-1 ring-white/20", onClick:next, "aria-label":"다음" },"›")
            )
          ),

          React.createElement("footer",{ className:"mx-auto max-w-screen-sm pb-14 pt-2 text-center text-xs text-neutral-500" }, `© ${new Date().getFullYear()} @ryo_pht`)
        );
      }

      const root = ReactDOM.createRoot(document.getElementById('root'));
      root.render(React.createElement(App));
    </script>
  </body>
</html>
